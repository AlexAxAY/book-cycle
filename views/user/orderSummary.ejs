<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order summary</title>
  </head>
  <!-- bootstrap -->
  <%- include("../partials/admin/bootLink.ejs") %>

  <!-- icon link -->
  <%- include("../partials/user/iconLink.ejs") %>

  <!-- css -->
  <link rel="stylesheet" href="/user/stylesheets/orderSummary.css" />
  <body>
    <!-- navbar -->
    <header><%- include("../partials/user/userNavbar.ejs") %></header>

    <div class="container mt-4" style="min-height: calc(100vh - 212px)">
      <h1>Order Summary</h1>
      <div class="row my-5">
        <!-- Left Column -->
        <div class="col-lg-8">
          <div class="card p-4">
            <% order.products.forEach((product)=> { %>
            <div class="d-flex justify-content-between">
              <div>
                <h5 class="m-0"><%= product.name %></h5>
                <p class="m-0 text-muted">
                  <small>by <%= product.author %></small>
                </p>
                <p class="mb-2 text-muted">
                  <small><%= product.category %></small>
                </p>
                <h6>₹<%= product.price %></h6>
              </div>
              <img
                style="width: 70px"
                src="<%= product.images[0].cropped_url || product.images[0].original_url  %>"
                alt="Book Cover"
              />
            </div>
            <hr />
            <% }) %>
            <div class="row">
              <div class="col">
                <div class="order-status">
                  <p><i class="fas fa-check-circle"></i> <%= orderCreated %></p>
                  <% if (order.status === "Delivered") {%>
                  <p>
                    <i class="fas fa-check-circle"></i> Order delivered, 20 Oct,
                    2024
                  </p>
                  <% } %>
                </div>
                <a
                  class="text-primary"
                  style="cursor: pointer"
                  data-bs-toggle="modal"
                  data-bs-target="#deliveryModal"
                  >See All Details</a
                >
              </div>
              <div class="col text-end">
                <% 
                // prettier-ignore
                if (order.status === "Confirmed" || order.status === "In transit") { %>
                    <button class="btn btn-danger">Cancel order</button>
                <% } %>
            </div>            
            </div>

            <% if (order.status === "Delivered") {%>
            <hr />
            <h5 class="mt-3">Rate The Product</h5>
            <div class="rating">
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
            </div>
            <% } %>
          </div>
        </div>

        <!-- Right Column -->
        <div class="col-lg-4">
          <div class="invoice-btn mb-3">
            <i class="fas fa-file-download"></i> Download Invoice
          </div>
          <div class="card p-3 mb-3">
            <h6 class="text-muted">Shipping details</h6>
            <h5><%= order.address.name %></h5>
            <p>
              <%= order.address.address_line %><% if (order.address.landmark) {
              %>, <%= order.address.landmark %> <% } %>, <%= order.address.city
              %>, <%= order.address.state %> - <%= order.address.pincode %>
            </p>

            <p>
              <strong>Phone number:</strong> <%= order.address.phone %><% if
              (order.address.alt_phone) {%>, <%= order.address.alt_phone %> <% }
              %>
            </p>
          </div>
          <div class="card p-3">
            <h6 class="text-muted">Price details</h6>
            <div class="row">
              <div class="col-6 text-start">
                <p>Selling price</p>
                <p>Discount</p>
                <p>Delivery charge</p>
              </div>
              <div class="col-6 text-end">
                <p>₹<%= order.selling_price %></p>
                <p class="text-success">
                  ₹<%= order.total_discount.toFixed(2) %>
                </p>
                <p class="text-success">₹<%= order.delivery_charge %></p>
              </div>
            </div>

            <hr />
            <div class="row">
              <div class="col-6"><h5>Total Amount</h5></div>
              <div class="col-6 text-end">
                <h5>₹<%= order.final_amount %></h5>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div
      class="modal fade"
      id="deliveryModal"
      tabindex="-1"
      aria-labelledby="deliveryModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deliveryModalLabel">Delivery Status</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <ul class="timeline">
              <li>
                <i style="color: green" class="fas fa-check-circle"></i>
                <strong> Order confirmed</strong>
                <small class="text-muted"><%= orderCreated %></small>
              </li>
              <li>
                <% if(order.status === "In transit") {%>
                <i style="color: green" class="fas fa-check-circle"></i>
                <strong>In transit</strong>
                <small class="text-muted"
                  >Saturday, 26th Oct, 2024 - 1.25pm</small
                >
                <% }else { %>
                <i class="fa-regular fa-circle"></i>
                <strong>In transit</strong>
                <% } %>
              </li>
              <li>
                <% if(order.status === "Shipped") {%>
                <i style="color: green" class="fas fa-check-circle"></i>
                <strong>Shipped</strong>
                <small class="text-muted"
                  >Monday, 28th Oct, 2024 - 11.20am</small
                >
                <% }else { %>
                <i class="fa-regular fa-circle"></i>
                <strong>Shipped</strong>
                <% } %>
              </li>
              <li>
                <% if(order.status === "Shipped") {%>
                <i style="color: green" class="fas fa-check-circle"></i>
                <strong>Delivered</strong>
                <small class="text-muted"
                  >Tuesday, 29th Oct, 2024 - 11.00pm</small
                >
                <% }else { %>
                <i class="fa-regular fa-circle"></i>
                <strong>Delivered</strong>
                <% } %>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- footer partial -->
    <footer><%- include("../partials/user/userFooter.ejs") %></footer>

    <!-- logout -->
    <script src="/user/helper/logoutHelper.js"></script>

    <!-- pending user clear -->
    <script src="/user/helper/removePendingUser.js"></script>

    <!-- Include Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- bootstrap -->
    <%- include("../partials/admin/bootScript.ejs") %>
  </body>
</html>
